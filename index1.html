<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceny per v Evropě - interaktivní srovnání</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=20250605_1430">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --new-color: #ff6b6b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--light);
            transition: all 0.3s ease;
        }
        
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            position: relative;
            font-size: 2.2rem;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 2px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            min-width: 220px;
            flex-grow: 1;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        select, button {
            padding: 10px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        select {
            background-color: white;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234361ee' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            appearance: none;
            padding-right: 40px;
        }
        
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 42px;
            min-width: 150px;
        }
        
        button:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            transition: all 0.3s;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
            min-width: 1000px; /* Base min-width for larger screens */
        }
        
        th {
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 600;
            padding: 15px 8px;
            text-align: left;
            cursor: pointer;
            position: sticky;
            top: 0;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        th:first-child {
            border-top-left-radius: 10px;
        }
        
        th:last-child {
            border-top-right-radius: 10px;
        }
        
        th:hover {
            background: linear-gradient(to bottom, var(--primary-dark), var(--secondary));
        }
        
        th i {
            margin-left: 8px;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        th:hover i {
            opacity: 1;
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid var(--light-gray);
            vertical-align: middle;
            transition: all 0.3s;
            position: relative;
            font-size: 0.9rem;
        }
        
        tr:nth-child(even) {
            background-color: rgba(248, 249, 250, 0.5);
        }
        
        tr:hover {
            background-color: rgba(72, 149, 239, 0.1) !important;
        }
        
        .country {
            font-weight: bold;
            background: linear-gradient(to right, rgba(67, 97, 238, 0.1), rgba(72, 149, 239, 0.1)) !important;
            position: sticky;
            top: 50px;
        }
        
        .country td {
            font-size: 1.1em;
            padding: 10px 15px;
        }
        
        .price-very-high {
            color: var(--danger);
            font-weight: bold;
        }
        
        .price-high {
            color: var(--warning);
            font-weight: 600;
        }
        
        .price-medium {
            color: #f1c40f;
        }
        
        .price-low {
            color: #2ecc71;
            font-weight: 600;
        }
        
        .best-price-row {
            background: linear-gradient(to right, rgba(76, 201, 240, 0.1), rgba(76, 201, 240, 0.05)) !important;
            border-left: 4px solid var(--success);
        }
        
        .best-price {
            color: var(--success);
            font-weight: bold;
            position: relative;
        }
        
        .best-price::after {
            content: '★';
            margin-left: 5px;
            font-size: 0.9em;
        }
        
        .note {
            font-size: 0.85em;
            color: var(--gray);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 0.9em;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            flex: 1;
            min-width: 200px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stat-card i {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: var(--gray);
        }

        /* Styly pro odkazy */
        .links-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .links-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .link-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .help-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(72, 149, 239, 0.3);
        }

        .help-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(72, 149, 239, 0.4);
            text-decoration: none;
            color: white;
        }

        .help-link i {
            font-size: 1.2em;
        }
        
        .new-item {
            background-color: rgba(255, 107, 107, 0.1);
        }

        .new-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--new-color);
            color: white;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            text-transform: uppercase;
        }

        .new-note {
            color: var(--new-color);
            font-weight: bold;
        }

        /* Grafické srovnání cen */
        .price-chart {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 30px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin-bottom: 25px;
        }

        .price-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .price-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .price-bar:hover {
            background-color: rgba(72, 149, 239, 0.1);
            transform: translateX(5px);
        }

        .bar-label {
            min-width: 150px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9em;
        }

        .bar-visual {
            flex: 1;
            height: 35px;
            border-radius: 17px;
            position: relative;
            background: linear-gradient(90deg, var(--light-gray), #f8f9fa);
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 17px;
            position: relative;
            transition: width 1.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .bar-best {
            background: linear-gradient(90deg, var(--success), #2ecc71);
            animation: highlight 2s ease-in-out infinite alternate;
            box-shadow: 0 2px 8px rgba(76, 201, 240, 0.3);
        }

        .bar-good {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
        }

        .bar-medium {
            background: linear-gradient(90deg, #f1c40f, #f39c12);
        }

        .bar-high {
            background: linear-gradient(90deg, var(--warning), #e67e22);
        }

        .bar-very-high {
            background: linear-gradient(90deg, var(--danger), #c0392b);
        }

        @keyframes highlight {
            0% { box-shadow: 0 2px 8px rgba(76, 201, 240, 0.3); }
            100% { box-shadow: 0 4px 20px rgba(76, 201, 240, 0.6), 0 0 30px rgba(76, 201, 240, 0.2); }
        }

        .best-deal-badge {
            position: absolute;
            top: -8px;
            right: 10px;
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 2;
        }

        .best-deal-badge::before {
            content: "⭐ ";
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .control-group {
                width: 100%;
            }
            
            button {
                width: 100%;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .stat-card {
                min-width: 100%;
            }

            /* Mobile table layout improvements */
            .table-container {
                overflow-x: hidden; /* Prevent horizontal scroll on small screens */
            }

            table {
                display: block; /* Make table a block to allow flexbox on rows */
                width: 100%;
                min-width: unset; /* Remove min-width for mobile */
            }

            thead {
                display: none; /* Hide table header on small screens */
            }

            tr {
                display: block; /* Make table rows behave like blocks */
                margin-bottom: 15px;
                border: 1px solid var(--light-gray);
                border-radius: 8px;
                padding: 10px;
                background-color: white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            }

            tr:nth-child(even) {
                background-color: var(--light); /* Reset even row background for card-like appearance */
            }
            
            tr:hover {
                background-color: rgba(72, 149, 239, 0.1) !important;
            }

            td {
                display: flex; /* Make table cells behave like flex items */
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px dashed var(--light-gray); /* Use dashed border for separation */
                font-size: 0.9rem;
            }

            td:last-child {
                border-bottom: none; /* No border for the last cell in a row */
            }

            td::before {
                /* Add column headers as data attributes for mobile view */
                content: attr(data-label) ": ";
                font-weight: bold;
                color: var(--primary-dark);
                flex-basis: 40%; /* Adjust as needed */
                text-align: left;
                padding-right: 10px;
            }

            /* Specific styling for the 'country' row to maintain prominence */
            .country {
                display: block;
                position: static; /* Remove sticky on mobile */
                background: linear-gradient(to right, rgba(67, 97, 238, 0.15), rgba(72, 149, 239, 0.15)) !important;
                border-radius: 8px 8px 0 0; /* Keep top corners rounded */
                margin-bottom: 0;
                padding: 10px 15px 5px 15px; /* Adjust padding */
                box-shadow: none; /* Remove redundant shadow */
            }

            .country td {
                font-size: 1.1em;
                font-weight: bold;
                justify-content: center; /* Center country name */
                padding: 5px 0;
                border-bottom: none;
                color: var(--primary-dark);
            }

            .country td::before {
                content: none; /* Hide generated label for country name */
            }
            
            .links-section {
                padding: 20px;
            }

            .link-container {
                flex-direction: column;
            }

            .help-link {
                width: 100%;
                justify-content: center;
            }

            .price-chart {
                padding: 20px;
            }
            .bar-label {
                min-width: 100px; /* Adjust min-width for mobile bar labels */
                font-size: 0.8em;
            }
            .bar-fill {
                font-size: 0.75em;
                padding-right: 8px;
            }
        }
        
        /* Animace */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-euro-sign"></i> Ceny per v evropských zemích</h1>
    
    <div class="stats">
        <div class="stat-card fade-in" style="animation-delay: 0.1s;">
            <i class="fas fa-globe-europe"></i>
            <div class="stat-value" id="country-count">5</div>
            <div class="stat-label">Zemí v porovnání</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 0.2s;">
            <i class="fas fa-list-ol"></i>
            <div class="stat-value" id="product-count">0</div>
            <div class="stat-label">Dostupných produktů</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 0.3s;">
            <i class="fas fa-trophy"></i>
            <div class="stat-value" id="best-price">0 Kč</div>
            <div class="stat-label">Nejlepší cena / 1mg</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 0.4s;">
            <i class="fas fa-piggy-bank"></i>
            <div class="stat-value" id="price-saving">0 Kč</div>
            <div class="stat-label">Úspora při správné volbě</div>
        </div>
    </div>
    
    <div class="controls fade-in" style="animation-delay: 0.5s;">
        <div class="control-group">
            <label for="country-filter"><i class="fas fa-filter"></i> Filtrovat zemi:</label>
            <select id="country-filter">
                <option value="all" selected>Všechny země</option>
                <option value="Česko">Česko</option>
                <option value="Slovensko">Slovensko</option>
                <option value="Německo">Německo</option>
                <option value="Polsko">Polsko</option>
                <option value="Rakousko">Rakousko</option>
            </select>
        </div>
        <div class="control-group">
            <label for="harness-filter"><i class="fas fa-vest"></i> Filtrovat pero:</label>
            <select id="harness-filter">
                <option value="all">Všechny typy</option>
                <option value="2.5">2.5</option>
                <option value="5">5</option>
                <option value="7.5">7.5</option>
                <option value="10">10</option>
                <option value="12.5">12.5</option>
                <option value="15">15</option>
            </select>
        </div>
        <div class="control-group">
            <label for="sort-by"><i class="fas fa-sort-amount-down"></i> Seřadit podle:</label>
            <select id="sort-by">
                <option value="default">Výchozí řazení</option>
                <option value="price-asc">Nejlevnější (vše)</option>
                <option value="price-desc">Nejdražší (vše)</option>
                <option value="country-price">Nejlevnější v zemi</option>
                <option value="substance-asc">Podle účinné látky (vzestupně)</option>
                <option value="substance-desc">Podle účinné látky (sestupně)</option>
            </select>
        </div>
        <button id="apply-btn" class="pulse">
            <i class="fas fa-check"></i> Aplikovat
        </button>
    </div>
    
    <div class="price-chart fade-in" style="animation-delay: 0.6s;">
        <div class="chart-title">
            <i class="fas fa-chart-bar"></i> Grafické srovnání cen za 1mg
        </div>
        <div class="price-bars" id="price-bars">
            </div>
    </div>
    
    <div class="table-container fade-in" style="animation-delay: 0.7s;">
        <table id="price-table">
            <thead>
                <tr>
                    <th data-sort="country">Země <i class="fas fa-sort"></i></th>
                    <th data-sort="harness">Pero <i class="fas fa-sort"></i></th>
                    <th data-sort="substance">Účinné látky <i class="fas fa-sort"></i></th>
                    <th data-sort="original-price">Cena orig. <i class="fas fa-sort"></i></th>
                    <th data-sort="czk-price">Cena CZK <i class="fas fa-sort"></i></th>
                    <th data-sort="unit-price">Cena/1mg CZK <i class="fas fa-sort"></i></th>
                    <th data-sort="unit-price-gold">Cena/1mg včetně zlaté dávky <i class="fas fa-sort"></i></th>
                    <th>Poznámka</th>
                </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>

    <div class="links-section fade-in" style="animation-delay: 0.9s;">
        <h3><i class="fas fa-tools"></i> Užitečné kalkulačky a nástroje</h3>
        <div class="link-container">
            <a href="https://onli1971.github.io/kalkulacka-kliku/" class="help-link" target="_blank">
                <i class="fas fa-calculator"></i>
                Kalkulačka kliků pera
            </a>
            <a href="https://onli1971.github.io/kalkulacka-davek/" class="help-link" target="_blank">
                <i class="fas fa-syringe"></i>
                Kalkulačka zlaté dávky
            </a>
            <a href="https://ylv4f498kbphj8gezeibm9kh.macaly.dev/" class="help-link" style="background: linear-gradient(135deg, #4cc9f0, #4361ee);">
                <i class="fas fa-chart-line"></i>
                Srovnání nákladů M 5mg
            </a>
        </div>
    </div>

    <footer class="fade-in" style="animation-delay: 1.0s;">
        <p><i class="fas fa-info-circle"></i> Kurzová konverze: 1 EUR = 25.50 CZK, 1 PLN = 5.90 CZK | Poslední aktualizace: červen 2025</p>
        <p><i class="fas fa-sync-alt"></i> Data se aktualizují automaticky při změně filtrů</p>
    </footer>

    <script>
        // Definice kurzů měn pro přepočty
        const EUR_TO_CZK = 25.50;
        const PLN_TO_CZK = 5.90;

        // Funkce pro přepočet ceny z EUR na CZK
        function convertEurToCzk(eurPrice) {
            if (typeof eurPrice === 'string') {
                eurPrice = parseFloat(eurPrice.replace(',', '.').replace(/[^0-9.-]+/g,""));
            }
            return (eurPrice * EUR_TO_CZK).toFixed(2);
        }

        // Funkce pro přepočet ceny z PLN na CZK
        function convertPlnToCzk(plnPrice) {
            if (typeof plnPrice === 'string') {
                plnPrice = parseFloat(plnPrice.replace(',', '.').replace(/[^0-9.-]+/g,""));
            }
            return (plnPrice * PLN_TO_CZK).toFixed(2);
        }

        // Data tabulky - UPRAVENO: přidány ceny pro Slovensko 12.5 a 15mg
        const tableData = [
            // Česko
            { country: "Česko", harness: "2.5", substance: "10 mg", originalPrice: "4,790.00 Kč", czkPrice: "4,790.00 Kč", unitPrice: 479, unitPriceGold: 319, note: "" },
            { country: "Česko", harness: "5", substance: "20 mg", originalPrice: "6,130.00 Kč", czkPrice: "6,130.00 Kč", unitPrice: 307, unitPriceGold: 204, note: "" },
            { country: "Česko", harness: "5*5*5", substance: "60 mg", originalPrice: "18,390.00 Kč", czkPrice: "18,390.00 Kč", unitPrice: 307, unitPriceGold: 204, note: "cena v setu za 3 pera" },
            { country: "Česko", harness: "7.5", substance: "30 mg", originalPrice: "8,790.00 Kč", czkPrice: "8,790.00 Kč", unitPrice: 293, unitPriceGold: 195, note: "" },
            { country: "Česko", harness: "10", substance: "40 mg", originalPrice: "Zatím není v nabídce", czkPrice: "", unitPrice: null, unitPriceGold: null, note: "předpoklad podzim 2025" },
            { country: "Česko", harness: "10*10*10", substance: "120 mg", originalPrice: "25,490.00 Kč", czkPrice: "25,490.00 Kč", unitPrice: 212, unitPriceGold: 142, note: "cena v setu za 3 pera" },
            { country: "Česko", harness: "12.5", substance: "50 mg", originalPrice: "11,190.00 Kč", czkPrice: "11,190.00 Kč", unitPrice: 224, unitPriceGold: 163, note: "od 07/2025" },
            { country: "Česko", harness: "15", substance: "60 mg", originalPrice: "11,190.00 Kč", czkPrice: "11,190.00 Kč", unitPrice: 186, unitPriceGold: 136, note: "od 07/2025" },
            
            // Slovensko - AKTUÁLNÍ CENY DLE POŽADAVKU
            { country: "Slovensko", harness: "2.5", substance: "10 mg", originalPrice: "177.00 €", czkPrice: convertEurToCzk("177.00") + " Kč", unitPrice: Math.round(convertEurToCzk("177.00") / 10), unitPriceGold: Math.round(convertEurToCzk("177.00") / 15), note: "" },
            { country: "Slovensko", harness: "5", substance: "20 mg", originalPrice: "235.00 €", czkPrice: convertEurToCzk("235.00") + " Kč", unitPrice: Math.round(convertEurToCzk("235.00") / 20), unitPriceGold: Math.round(convertEurToCzk("235.00") / 30), note: "" },
            { country: "Slovensko", harness: "5*5*5", substance: "60 mg", originalPrice: "710.00 €", czkPrice: convertEurToCzk("710.00") + " Kč", unitPrice: Math.round(convertEurToCzk("710.00") / 60), unitPriceGold: Math.round(convertEurToCzk("710.00") / 90), note: "cena v setu za 3 pera" },
            { country: "Slovensko", harness: "7.5", substance: "30 mg", originalPrice: "335.00 €", czkPrice: convertEurToCzk("335.00") + " Kč", unitPrice: Math.round(convertEurToCzk("335.00") / 30), unitPriceGold: Math.round(convertEurToCzk("335.00") / 45), note: "" },
            { country: "Slovensko", harness: "10", substance: "40 mg", originalPrice: "350.00 €", czkPrice: convertEurToCzk("350.00") + " Kč", unitPrice: Math.round(convertEurToCzk("350.00") / 40), unitPriceGold: Math.round(convertEurToCzk("350.00") / 60), note: "" },
            { country: "Slovensko", harness: "10*10*10", substance: "120 mg", originalPrice: "991.00 €", czkPrice: convertEurToCzk("991.00") + " Kč", unitPrice: Math.round(convertEurToCzk("991.00") / 120), unitPriceGold: Math.round(convertEurToCzk("991.00") / 180), note: "cena v setu za 3 pera" },
            { country: "Slovensko", harness: "12.5", substance: "50 mg", originalPrice: "429.00 €", czkPrice: convertEurToCzk("429.00") + " Kč", unitPrice: Math.round(convertEurToCzk("429.00") / 50), unitPriceGold: Math.round(convertEurToCzk("429.00") / 75), note: "Nová cena" },
            { country: "Slovensko", harness: "15", substance: "60 mg", originalPrice: "429.00 €", czkPrice: convertEurToCzk("429.00") + " Kč", unitPrice: Math.round(convertEurToCzk("429.00") / 60), unitPriceGold: Math.round(convertEurToCzk("429.00") / 90), note: "Nová cena" },
            
            // Německo
            { country: "Německo", harness: "2.5", substance: "10 mg", originalPrice: "206.00 €", czkPrice: convertEurToCzk("206.00") + " Kč", unitPrice: Math.round(convertEurToCzk("206.00") / 10), unitPriceGold: Math.round(convertEurToCzk("206.00") / 15), note: "" },
            { country: "Německo", harness: "5", substance: "20 mg", originalPrice: "277.00 €", czkPrice: convertEurToCzk("277.00") + " Kč", unitPrice: Math.round(convertEurToCzk("277.00") / 20), unitPriceGold: Math.round(convertEurToCzk("277.00") / 30), note: "" },
            { country: "Německo", harness: "7.5", substance: "30 mg", originalPrice: "383.00 €", czkPrice: convertEurToCzk("383.00") + " Kč", unitPrice: Math.round(convertEurToCzk("383.00") / 30), unitPriceGold: Math.round(convertEurToCzk("383.00") / 45), note: "" },
            { country: "Německo", harness: "10", substance: "40 mg", originalPrice: "383.00 €", czkPrice: convertEurToCzk("383.00") + " Kč", unitPrice: Math.round(convertEurToCzk("383.00") / 40), unitPriceGold: Math.round(convertEurToCzk("383.00") / 60), note: "" },
            { country: "Německo", harness: "12.5", substance: "50 mg", originalPrice: "489.00 €", czkPrice: convertEurToCzk("489.00") + " Kč", unitPrice: Math.round(convertEurToCzk("489.00") / 50), unitPriceGold: Math.round(convertEurToCzk("489.00") / 75), note: "" },
            { country: "Německo", harness: "15", substance: "60 mg", originalPrice: "489.00 €", czkPrice: convertEurToCzk("489.00") + " Kč", unitPrice: Math.round(convertEurToCzk("489.00") / 60), unitPriceGold: Math.round(convertEurToCzk("489.00") / 90), note: "" },
            { country: "Německo", harness: "15*15*15", substance: "180 mg", originalPrice: "1,445.00 €", czkPrice: convertEurToCzk("1445.00") + " Kč", unitPrice: Math.round(convertEurToCzk("1445.00") / 180), unitPriceGold: Math.round(convertEurToCzk("1445.00") / 270), note: "cena v setu za 3 pera" },
            
            // Polsko
            { country: "Polsko", harness: "2.5", substance: "10 mg", originalPrice: "890.00 zl", czkPrice: convertPlnToCzk("890.00") + " Kč", unitPrice: Math.round(convertPlnToCzk("890.00") / 10), unitPriceGold: Math.round(convertPlnToCzk("890.00") / 15), note: "" },
            { country: "Polsko", harness: "5", substance: "20 mg", originalPrice: "1,165.00 zl", czkPrice: convertPlnToCzk("1165.00") + " Kč", unitPrice: Math.round(convertPlnToCzk("1165.00") / 20), unitPriceGold: Math.round(convertPlnToCzk("1165.00") / 30), note: "" },
            { country: "Polsko", harness: "7.5", substance: "30 mg", originalPrice: "1,630.00 zl", czkPrice: convertPlnToCzk("1630.00") + " Kč", unitPrice: Math.round(convertPlnToCzk("1630.00") / 30), unitPriceGold: Math.round(convertPlnToCzk("1630.00") / 45), note: "" },
            { country: "Polsko", harness: "10", substance: "40 mg", originalPrice: "", czkPrice: "", unitPrice: null, unitPriceGold: null, note: "" },
            { country: "Polsko", harness: "12.5", substance: "50 mg", originalPrice: "2,097.00 zl", czkPrice: convertPlnToCzk("2097.00") + " Kč", unitPrice: Math.round(convertPlnToCzk("2097.00") / 50), unitPriceGold: Math.round(convertPlnToCzk("2097.00") / 75), note: "" },
            { country: "Polsko", harness: "15", substance: "60 mg", originalPrice: "2,097.00 zl", czkPrice: convertPlnToCzk("2097.00") + " Kč", unitPrice: Math.round(convertPlnToCzk("2097.00") / 60), unitPriceGold: Math.round(convertPlnToCzk("2097.00") / 90), note: "" },
            
            // Rakousko
            { country: "Rakousko", harness: "2.5", substance: "10 mg", originalPrice: "", czkPrice: "", unitPrice: null, unitPriceGold: null, note: "" },
            { country: "Rakousko", harness: "5", substance: "20 mg", originalPrice: "", czkPrice: "", unitPrice: null, unitPriceGold: null, note: "" },
            { country: "Rakousko", harness: "7.5", substance: "30 mg", originalPrice: "466.00 €", czkPrice: convertEurToCzk("466.00") + " Kč", unitPrice: Math.round(convertEurToCzk("466.00") / 30), unitPriceGold: Math.round(convertEurToCzk("466.00") / 45), note: "" },
            { country: "Rakousko", harness: "10", substance: "40 mg", originalPrice: "466.00 €", czkPrice: convertEurToCzk("466.00") + " Kč", unitPrice: Math.round(convertEurToCzk("466.00") / 40), unitPriceGold: Math.round(convertEurToCzk("466.00") / 60), note: "" },
            { country: "Rakousko", harness: "12.5", substance: "50 mg", originalPrice: "", czkPrice: "", unitPrice: null, unitPriceGold: null, note: "" },
            { country: "Rakousko", harness: "15", substance: "60 mg", originalPrice: "581.40 €", czkPrice: convertEurToCzk("581.40") + " Kč", unitPrice: Math.round(convertEurToCzk("581.40") / 60), unitPriceGold: Math.round(convertEurToCzk("581.40") / 90), note: "" }
        ];

        // Renderování grafického srovnání cen
        function renderPriceChart(data) {
            const validItems = data.filter(item => item.unitPrice !== null && item.unitPrice > 0);
            if (validItems.length === 0) return;
            
            // Seřadit podle ceny
            validItems.sort((a, b) => a.unitPrice - b.unitPrice);
            
            const minPrice = validItems[0].unitPrice;
            const maxPrice = validItems[validItems.length - 1].unitPrice;

            const priceBarsContainer = document.getElementById('price-bars');
            priceBarsContainer.innerHTML = ''; // Clear previous bars

            validItems.forEach(item => {
                const bar = document.createElement('div');
                bar.className = 'price-bar';

                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = `${item.country} ${item.harness}mg`;
                bar.appendChild(barLabel);

                const barVisual = document.createElement('div');
                barVisual.className = 'bar-visual';

                const barFill = document.createElement('div');
                let fillWidth = (item.unitPrice - minPrice) / (maxPrice - minPrice) * 100;
                if (maxPrice === minPrice) { // Handle case where all prices are the same
                    fillWidth = 100;
                } else if (fillWidth === 0 && item.unitPrice === minPrice) { // Ensure min price bar is visible
                    fillWidth = 10; // Minimum width for the best price bar
                } else {
                    fillWidth = 10 + (fillWidth * 0.9); // Scale to not be too small/large
                }
                
                barFill.style.width = `${fillWidth}%`;
                barFill.textContent = `${item.unitPrice} CZK/mg`;

                let barClass = '';
                if (item.unitPrice === minPrice) {
                    barClass = 'bar-best';
                    const bestDealBadge = document.createElement('span');
                    bestDealBadge.className = 'best-deal-badge';
                    bestDealBadge.textContent = 'Nejlepší nabídka';
                    barVisual.appendChild(bestDealBadge);
                } else if (item.unitPrice < minPrice * 1.2) {
                    barClass = 'bar-good';
                } else if (item.unitPrice < minPrice * 1.5) {
                    barClass = 'bar-medium';
                } else if (item.unitPrice < minPrice * 2) {
                    barClass = 'bar-high';
                } else {
                    barClass = 'bar-very-high';
                }
                barFill.classList.add(barClass);

                barVisual.appendChild(barFill);
                bar.appendChild(barVisual);
                priceBarsContainer.appendChild(bar);
            });
        }

        // Zde jsou definice pro selektory a tlačítka
        const countryFilter = document.getElementById('country-filter');
        const harnessFilter = document.getElementById('harness-filter');
        const sortBy = document.getElementById('sort-by');
        const applyBtn = document.getElementById('apply-btn');
        const tableBody = document.getElementById('table-body');
        const priceTable = document.getElementById('price-table');

        let currentSortColumn = 'default';
        let currentSortDirection = 'asc';

        // Funkce pro aktualizaci tabulky na základě filtrů a řazení
        function updateTable() {
            let filteredData = [...tableData]; // Kopie původních dat

            // Aplikovat filtr země
            const selectedCountry = countryFilter.value;
            if (selectedCountry !== 'all') {
                filteredData = filteredData.filter(item => item.country === selectedCountry);
            }

            // Aplikovat filtr pera (harness)
            const selectedHarness = harnessFilter.value;
            if (selectedHarness !== 'all') {
                filteredData = filteredData.filter(item => item.harness === selectedHarness);
            }

            // Odebrat produkty s null cenou pro výpočty a zobrazení
            const validData = filteredData.filter(item => item.unitPrice !== null);

            // Řazení
            const sortKey = sortBy.value;
            if (sortKey === 'default') {
                // Výchozí řazení (podle pořadí v datech, pak podle pera)
                filteredData.sort((a, b) => {
                    const countryOrder = ["Česko", "Slovensko", "Německo", "Polsko", "Rakousko"];
                    const harnessOrder = ["2.5", "5", "7.5", "10", "12.5", "15", "5*5*5", "10*10*10", "15*15*15"];
                    
                    const countryA = countryOrder.indexOf(a.country);
                    const countryB = countryOrder.indexOf(b.country);
                    
                    if (countryA !== countryB) {
                        return countryA - countryB;
                    }
                    
                    const harnessA = harnessOrder.indexOf(a.harness);
                    const harnessB = harnessOrder.indexOf(b.harness);
                    
                    return harnessA - harnessB;
                });
            } else if (sortKey === 'price-asc') {
                filteredData.sort((a, b) => (a.unitPrice || Infinity) - (b.unitPrice || Infinity));
            } else if (sortKey === 'price-desc') {
                filteredData.sort((a, b) => (b.unitPrice || -Infinity) - (a.unitPrice || -Infinity));
            } else if (sortKey === 'country-price') {
                // Řazení podle nejlevnější v zemi (seřadí produkty v každé zemi)
                const groupedByCountry = filteredData.reduce((acc, item) => {
                    (acc[item.country] = acc[item.country] || []).push(item);
                    return acc;
                }, {});

                for (const country in groupedByCountry) {
                    groupedByCountry[country].sort((a, b) => (a.unitPrice || Infinity) - (b.unitPrice || Infinity));
                }

                filteredData = Object.values(groupedByCountry).flat(); // Sloučí zpět do jednoho pole
            } else if (sortKey === 'substance-asc') {
                filteredData.sort((a, b) => {
                    const valA = parseFloat(a.substance.replace(' mg', ''));
                    const valB = parseFloat(b.substance.replace(' mg', ''));
                    return valA - valB;
                });
            } else if (sortKey === 'substance-desc') {
                filteredData.sort((a, b) => {
                    const valA = parseFloat(a.substance.replace(' mg', ''));
                    const valB = parseFloat(b.substance.replace(' mg', ''));
                    return valB - valA;
                });
            } else if (sortKey === 'harness' || sortKey === 'original-price' || sortKey === 'czk-price' || sortKey === 'unit-price' || sortKey === 'unit-price-gold') {
                // Sorting for table headers if clicked
                if (currentSortColumn === sortKey) {
                    currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortColumn = sortKey;
                    currentSortDirection = 'asc';
                }

                filteredData.sort((a, b) => {
                    let valA, valB;
                    if (sortKey === 'harness') {
                        valA = parseFloat(a.harness);
                        valB = parseFloat(b.harness);
                    } else if (sortKey === 'original-price' || sortKey === 'czk-price') {
                        valA = parseFloat(a[sortKey].replace(',', '.').replace(/[^0-9.-]+/g,"")) || 0;
                        valB = parseFloat(b[sortKey].replace(',', '.').replace(/[^0-9.-]+/g,"")) || 0;
                    } else { // unit-price, unit-price-gold
                        valA = a[sortKey] || Infinity;
                        valB = b[sortKey] || Infinity;
                    }

                    if (valA < valB) return currentSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return currentSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // Najít nejnižší cenu za 1mg pro zobrazení "nejlepší nabídky" a výpočtu úspory
            const lowestUnitPrice = validData.length > 0 ? Math.min(...validData.map(item => item.unitPrice)) : 0;
            const highestUnitPrice = validData.length > 0 ? Math.max(...validData.map(item => item.unitPrice)) : 0;

            // Vyplnění tabulky
            tableBody.innerHTML = '';
            let lastCountry = null;
            filteredData.forEach(item => {
                // Přidat řádek země, pokud se změnila země nebo je to první položka
                if (item.country !== lastCountry) {
                    const countryRow = document.createElement('tr');
                    countryRow.classList.add('country');
                    countryRow.innerHTML = `<td colspan="8">${item.country}</td>`;
                    tableBody.appendChild(countryRow);
                    lastCountry = item.country;
                }

                const row = document.createElement('tr');
                let priceClass = '';
                if (item.unitPrice === lowestUnitPrice && item.unitPrice !== null) {
                    priceClass = 'best-price';
                    row.classList.add('best-price-row');
                } else if (item.unitPrice >= lowestUnitPrice * 2 && item.unitPrice !== null) {
                    priceClass = 'price-very-high';
                } else if (item.unitPrice >= lowestUnitPrice * 1.5 && item.unitPrice !== null) {
                    priceClass = 'price-high';
                } else if (item.unitPrice >= lowestUnitPrice * 1.2 && item.unitPrice !== null) {
                    priceClass = 'price-medium';
                } else if (item.unitPrice !== null && item.unitPrice > 0) {
                    priceClass = 'price-low';
                }

                let unitPriceText = item.unitPrice !== null ? `${item.unitPrice} Kč` : 'N/A';
                let unitPriceGoldText = item.unitPriceGold !== null ? `${item.unitPriceGold} Kč` : 'N/A';

                row.innerHTML = `
                    <td data-label="Země">${item.country}</td>
                    <td data-label="Pero">${item.harness}</td>
                    <td data-label="Účinné látky">${item.substance}</td>
                    <td data-label="Cena orig.">${item.originalPrice}</td>
                    <td data-label="Cena CZK">${item.czkPrice}</td>
                    <td data-label="Cena/1mg CZK" class="${priceClass}">${unitPriceText}</td>
                    <td data-label="Cena/1mg zl. dávka" class="${priceClass}">${unitPriceGoldText}</td>
                    <td data-label="Poznámka">${item.note} ${item.note.includes("Nová cena") ? '<span class="new-badge">Nové</span>' : ''}</td>
                `;
                tableBody.appendChild(row);
            });

            // Aktualizace statistik
            document.getElementById('product-count').textContent = validData.length;
            document.getElementById('best-price').textContent = lowestUnitPrice !== 0 ? `${lowestUnitPrice} Kč` : 'N/A';
            
            let savings = 0;
            if (lowestUnitPrice > 0 && highestUnitPrice > 0 && highestUnitPrice !== Infinity) {
                savings = (highestUnitPrice - lowestUnitPrice);
            }
            document.getElementById('price-saving').textContent = savings > 0 ? `${savings.toFixed(0)} Kč` : '0 Kč';

            // Renderování grafu
            renderPriceChart(validData);

            // Nastavení ikon řazení
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.querySelector('i').className = 'fas fa-sort';
                if (th.dataset.sort === currentSortColumn) {
                    th.querySelector('i').className = `fas fa-sort-amount-${currentSortDirection === 'asc' ? 'up' : 'down'}`;
                }
            });
        }

        // Event Listeners
        applyBtn.addEventListener('click', updateTable);
        countryFilter.addEventListener('change', updateTable);
        harnessFilter.addEventListener('change', updateTable);
        sortBy.addEventListener('change', updateTable);

        // Event listeners pro řazení kliknutím na hlavičku tabulky
        document.querySelectorAll('#price-table th[data-sort]').forEach(header => {
            header.addEventListener('click', () => {
                // Set the select box value to "default" so that the header sorting takes precedence
                sortBy.value = 'default'; 
                currentSortColumn = header.dataset.sort;
                updateTable();
            });
        });

        // Počáteční načtení tabulky
        updateTable();
    </script>
</body>
</html>
